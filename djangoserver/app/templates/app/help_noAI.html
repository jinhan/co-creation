{% load staticfiles %}
{% load static %}

<!DOCTYPE html>
<html>

<head>
  <title>help_noAI</title>
  <meta charset="UTF-8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    #sketch{}
    body {
      padding: 0;
      margin: 0;
    }
    #penWeight{
      top: 80px;
      left: 25px;
      background: url("/static/imgsrc/Penicon.png") center center no-repeat;
      background-size: 15px 50px;
    }
    #brushWeight{
      top: 175px;
      left: 25px;
      background: url("/static/imgsrc/Brushicon.png") center center no-repeat;
      background-size: 25px 50px;
    }
    #cancel{
      top: 270px;
      left: 25px;
      background: url("/static/imgsrc/Cancelicon.png") center center no-repeat;
      background-size: 50px 34px;
    }
    #p_cntr{
      position: absolute;
      top: 365px;
      left: 25px;
    }
    #pallet{
      background-color: black;
    }
    .icons{
      width: 70px;
      height: 70px;
      position: fixed;
      box-sizing: border-box;
      display: inline-block;
      position: absolute;
      border-radius: 100%;
      border: 5px solid gray;
      background-color: rgb(100,100,100);
      cursor: pointer;
      z-index: 1;
    }
    /*.icons:hover{
      background-color: rgb(200,200,200);
    }*/
    .colorVal{
      display: inline-block;
      margin: 5px;
      border-radius: 100%;
      width: 30px;
      height: 30px;
    }
    #header{
      display: block;
      background-color: rgba(0,0,0,0.8);
      /*height: 110px;*/
      height: 55px;
    }
    #title{
      position: relative;
      display: inline-block;
      font-family: sans-serif;
      /*font-size: 80px;*/
      font-size: 40px;
      color: white;
      font-weight: bold;
      /*left: 50px;*/
      left: 25px;
    }
    #footer{
      display: block;
      background-color: rgba(0,0,0,0.8);
      /*height: 110px;*/
      height: 55px;
    }
    #ticker{
      position: relative;
      display: block;
      margin: 11px 0px;
      font-family: sans-serif;
      /*font-size: 64px;*/
      font-size: 25px;
      color: yellow;
      text-align: center;
      width: 100%;
      /*left: 50px;*/
      /*left: 25px;*/
      float: right;
      overflow: scroll;
    }
    #button_cntr{
      position: relative;
      float: right;
      /*display: none;*/
    }
    .buttons{
      position: relative;
      margin: 11px 10px 11px 0px;
      background-color: rgb(100,100,100);
      border-radius: 30px;
      display: block;
      cursor: pointer;
      color: #ffffff;
      font-family: Arial;
      font-size: 20px;
      font-weight: bold;
      padding: 5px 15px;
      text-decoration: none;
      vertical-align: top;
      float: right;
    }

    .buttons:active {
      position: relative;
      top: 1px;
      background-color: gray;
    }
    .hashtag{
      position: relative;
      margin: 11px 10px 11px 0px;
      display: block;
      color: #ffffff;
      font-family: Arial;
      font-size: 20px;
      font-weight: bold;
      padding: 5px 15px;
      text-decoration: none;
      /*vertical-align: top;*/
      float: right;
    }
    #spaceAlert{
      box-sizing: border-box;
      position: absolute;
      border-radius: 100%;
      border: 5px dotted red;
      transition: border 2s, width 2s, height 2s, left 2s, top 2s;
    }

    #cover{
      position: fixed;
      display: none;
      top: 0px;
      left: 0px;
      width: 980px;
      height: 689px;
      z-index: 999;
      background: url('/static/imgsrc/AIicon.png') center center no-repeat;
      background-color: rgba(0,0,0,.5);
      background-size: 300px 300px;
    }
    #twinkle{
      position: absolute;
      top: 0px;
      left: 0px;
      width: 980px;
      height: 689px;
      z-index: 999;
      background: url('/static/imgsrc/MagnifyingGlassicon_red.png') center center no-repeat;
      /*background-color: rgba(0,0,0,.5);*/
      background-size: 144px 240px;
    }
    #colorchart{
      width: 120px;
      height: 150px;
      border-collapse: collapse;
      cursor: pointer;
    }

  </style>
  <script language="javascript" type="text/javascript" src="https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/bird.gen.js"></script>
  <script language="javascript" type="text/javascript" src="{% static 'js/p5.min.js' %}"></script>
  <script language="javascript" type="text/javascript" src="{% static 'js/p5.dom.min.js' %}"></script>
  <script language="javascript" type="text/javascript" src="https://storage.googleapis.com/quickdraw-models/sketchRNN/lib/numjs.js"></script>
  <script language="javascript" type="text/javascript" src="{% static 'js/sketch_rnn.js' %}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <!-- jQuery Cookie -->
  <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script> -->
</head>

<body style="background-color:white" onload="bodyOnLoad()">
  <div id="header">
    <div id ="title">HCCL</div>
    <div id ="button_sel3" class = "hashtag">#Talkative</div>
    <div id ="button_sel2" class = "hashtag">#Landscape</div>
    <div id ="button_sel1" class = "hashtag">#Help</div>
  </div>
  <div id="sketch"></div>
  <div id="penWeight" class="icons"></div>
  <div id='brushWeight' class="icons"></div>
  <div id='cancel' class="icons"></div>
  <div id='p_cntr'>
    <div id='pallet' class="icons"></div>
    <div id='palVal'>
      <table id="colorchart"><tr><td bgColor="#FBEFEF"></td><td bgColor="#FBF2EF"></td><td bgColor="#FBF5EF"></td><td bgColor="#FBF8EF"></td><td bgColor="#FBFBEF"></td><td bgColor="#F8FBEF"></td><td bgColor="#F5FBEF"></td><td bgColor="#F2FBEF"></td><td bgColor="#EFFBEF"></td><td bgColor="#EFFBF2"></td><td bgColor="#EFFBF5"></td><td bgColor="#EFFBF8"></td><td bgColor="#EFFBFB"></td><td bgColor="#EFF8FB"></td><td bgColor="#EFF5FB"></td><td bgColor="#EFF2FB"></td><td bgColor="#EFEFFB"></td><td bgColor="#F2EFFB"></td><td bgColor="#F5EFFB"></td><td bgColor="#F8EFFB"></td><td bgColor="#FBEFFB"></td><td bgColor="#FBEFF8"></td><td bgColor="#FBEFF5"></td><td bgColor="#FBEFF2"></td><td bgColor="#FFFFFF"></td></tr>
 <tr><td bgColor="#F8E0E0"></td><td bgColor="#F8E6E0"></td><td bgColor="#F8ECE0"></td><td bgColor="#F7F2E0"></td><td bgColor="#F7F8E0"></td><td bgColor="#F1F8E0"></td><td bgColor="#ECF8E0"></td><td bgColor="#E6F8E0"></td><td bgColor="#E0F8E0"></td><td bgColor="#E0F8E6"></td><td bgColor="#E0F8EC"></td><td bgColor="#E0F8F1"></td><td bgColor="#E0F8F7"></td><td bgColor="#E0F2F7"></td><td bgColor="#E0ECF8"></td><td bgColor="#E0E6F8"></td><td bgColor="#E0E0F8"></td><td bgColor="#E6E0F8"></td><td bgColor="#ECE0F8"></td><td bgColor="#F2E0F7"></td><td bgColor="#F8E0F7"></td><td bgColor="#F8E0F1"></td><td bgColor="#F8E0EC"></td><td bgColor="#F8E0E6"></td><td bgColor="#FAFAFA"></td></tr>
 <tr><td bgColor="#F6CECE"></td><td bgColor="#F6D8CE"></td><td bgColor="#F6E3CE"></td><td bgColor="#F5ECCE"></td><td bgColor="#F5F6CE"></td><td bgColor="#ECF6CE"></td><td bgColor="#E3F6CE"></td><td bgColor="#D8F6CE"></td><td bgColor="#CEF6CE"></td><td bgColor="#CEF6D8"></td><td bgColor="#CEF6E3"></td><td bgColor="#CEF6EC"></td><td bgColor="#CEF6F5"></td><td bgColor="#CEECF5"></td><td bgColor="#CEE3F6"></td><td bgColor="#CED8F6"></td><td bgColor="#CECEF6"></td><td bgColor="#D8CEF6"></td><td bgColor="#E3CEF6"></td><td bgColor="#ECCEF5"></td><td bgColor="#F6CEF5"></td><td bgColor="#F6CEEC"></td><td bgColor="#F6CEE3"></td><td bgColor="#F6CED8"></td><td bgColor="#F2F2F2"></td></tr>
 <tr><td bgColor="#F5A9A9"></td><td bgColor="#F5BCA9"></td><td bgColor="#F5D0A9"></td><td bgColor="#F3E2A9"></td><td bgColor="#F2F5A9"></td><td bgColor="#E1F5A9"></td><td bgColor="#D0F5A9"></td><td bgColor="#BCF5A9"></td><td bgColor="#A9F5A9"></td><td bgColor="#A9F5BC"></td><td bgColor="#A9F5D0"></td><td bgColor="#A9F5E1"></td><td bgColor="#A9F5F2"></td><td bgColor="#A9E2F3"></td><td bgColor="#A9D0F5"></td><td bgColor="#A9BCF5"></td><td bgColor="#A9A9F5"></td><td bgColor="#BCA9F5"></td><td bgColor="#D0A9F5"></td><td bgColor="#E2A9F3"></td><td bgColor="#F5A9F2"></td><td bgColor="#F5A9E1"></td><td bgColor="#F5A9D0"></td><td bgColor="#F5A9BC"></td><td bgColor="#E6E6E6"></td></tr>
 <tr><td bgColor="#F78181"></td><td bgColor="#F79F81"></td><td bgColor="#F7BE81"></td><td bgColor="#F5DA81"></td><td bgColor="#F3F781"></td><td bgColor="#D8F781"></td><td bgColor="#BEF781"></td><td bgColor="#9FF781"></td><td bgColor="#81F781"></td><td bgColor="#81F79F"></td><td bgColor="#81F7BE"></td><td bgColor="#81F7D8"></td><td bgColor="#81F7F3"></td><td bgColor="#81DAF5"></td><td bgColor="#81BEF7"></td><td bgColor="#819FF7"></td><td bgColor="#8181F7"></td><td bgColor="#9F81F7"></td><td bgColor="#BE81F7"></td><td bgColor="#DA81F5"></td><td bgColor="#F781F3"></td><td bgColor="#F781D8"></td><td bgColor="#F781BE"></td><td bgColor="#F7819F"></td><td bgColor="#D8D8D8"></td></tr>
 <tr><td bgColor="#FA5858"></td><td bgColor="#FA8258"></td><td bgColor="#FAAC58"></td><td bgColor="#F7D358"></td><td bgColor="#F4FA58"></td><td bgColor="#D0FA58"></td><td bgColor="#ACFA58"></td><td bgColor="#82FA58"></td><td bgColor="#58FA58"></td><td bgColor="#58FA82"></td><td bgColor="#58FAAC"></td><td bgColor="#58FAD0"></td><td bgColor="#58FAF4"></td><td bgColor="#58D3F7"></td><td bgColor="#58ACFA"></td><td bgColor="#5882FA"></td><td bgColor="#5858FA"></td><td bgColor="#8258FA"></td><td bgColor="#AC58FA"></td><td bgColor="#D358F7"></td><td bgColor="#FA58F4"></td><td bgColor="#FA58D0"></td><td bgColor="#FA58AC"></td><td bgColor="#FA5882"></td><td bgColor="#BDBDBD"></td></tr>
 <tr><td bgColor="#FE2E2E"></td><td bgColor="#FE642E"></td><td bgColor="#FE9A2E"></td><td bgColor="#FACC2E"></td><td bgColor="#F7FE2E"></td><td bgColor="#C8FE2E"></td><td bgColor="#9AFE2E"></td><td bgColor="#64FE2E"></td><td bgColor="#2EFE2E"></td><td bgColor="#2EFE64"></td><td bgColor="#2EFE9A"></td><td bgColor="#2EFEC8"></td><td bgColor="#2EFEF7"></td><td bgColor="#2ECCFA"></td><td bgColor="#2E9AFE"></td><td bgColor="#2E64FE"></td><td bgColor="#2E2EFE"></td><td bgColor="#642EFE"></td><td bgColor="#9A2EFE"></td><td bgColor="#CC2EFA"></td><td bgColor="#FE2EF7"></td><td bgColor="#FE2EC8"></td><td bgColor="#FE2E9A"></td><td bgColor="#FE2E64"></td><td bgColor="#A4A4A4"></td></tr>
 <tr><td bgColor="#FF0000"></td><td bgColor="#FF4000"></td><td bgColor="#FF8000"></td><td bgColor="#FFBF00"></td><td bgColor="#FFFF00"></td><td bgColor="#BFFF00"></td><td bgColor="#80FF00"></td><td bgColor="#40FF00"></td><td bgColor="#00FF00"></td><td bgColor="#00FF40"></td><td bgColor="#00FF80"></td><td bgColor="#00FFBF"></td><td bgColor="#00FFFF"></td><td bgColor="#00BFFF"></td><td bgColor="#0080FF"></td><td bgColor="#0040FF"></td><td bgColor="#0000FF"></td><td bgColor="#4000FF"></td><td bgColor="#8000FF"></td><td bgColor="#BF00FF"></td><td bgColor="#FF00FF"></td><td bgColor="#FF00BF"></td><td bgColor="#FF0080"></td><td bgColor="#FF0040"></td><td bgColor="#848484"></td></tr>
 <tr><td bgColor="#DF0101"></td><td bgColor="#DF3A01"></td><td bgColor="#DF7401"></td><td bgColor="#DBA901"></td><td bgColor="#D7DF01"></td><td bgColor="#A5DF00"></td><td bgColor="#74DF00"></td><td bgColor="#3ADF00"></td><td bgColor="#01DF01"></td><td bgColor="#01DF3A"></td><td bgColor="#01DF74"></td><td bgColor="#01DFA5"></td><td bgColor="#01DFD7"></td><td bgColor="#01A9DB"></td><td bgColor="#0174DF"></td><td bgColor="#013ADF"></td><td bgColor="#0101DF"></td><td bgColor="#3A01DF"></td><td bgColor="#7401DF"></td><td bgColor="#A901DB"></td><td bgColor="#DF01D7"></td><td bgColor="#DF01A5"></td><td bgColor="#DF0174"></td><td bgColor="#DF013A"></td><td bgColor="#6E6E6E"></td></tr>
 <tr><td bgColor="#B40404"></td><td bgColor="#B43104"></td><td bgColor="#B45F04"></td><td bgColor="#B18904"></td><td bgColor="#AEB404"></td><td bgColor="#86B404"></td><td bgColor="#5FB404"></td><td bgColor="#31B404"></td><td bgColor="#04B404"></td><td bgColor="#04B431"></td><td bgColor="#04B45F"></td><td bgColor="#04B486"></td><td bgColor="#04B4AE"></td><td bgColor="#0489B1"></td><td bgColor="#045FB4"></td><td bgColor="#0431B4"></td><td bgColor="#0404B4"></td><td bgColor="#3104B4"></td><td bgColor="#5F04B4"></td><td bgColor="#8904B1"></td><td bgColor="#B404AE"></td><td bgColor="#B40486"></td><td bgColor="#B4045F"></td><td bgColor="#B40431"></td><td bgColor="#585858"></td></tr>
 <tr><td bgColor="#8A0808"></td><td bgColor="#8A2908"></td><td bgColor="#8A4B08"></td><td bgColor="#886A08"></td><td bgColor="#868A08"></td><td bgColor="#688A08"></td><td bgColor="#4B8A08"></td><td bgColor="#298A08"></td><td bgColor="#088A08"></td><td bgColor="#088A29"></td><td bgColor="#088A4B"></td><td bgColor="#088A68"></td><td bgColor="#088A85"></td><td bgColor="#086A87"></td><td bgColor="#084B8A"></td><td bgColor="#08298A"></td><td bgColor="#08088A"></td><td bgColor="#29088A"></td><td bgColor="#4B088A"></td><td bgColor="#6A0888"></td><td bgColor="#8A0886"></td><td bgColor="#8A0868"></td><td bgColor="#8A084B"></td><td bgColor="#8A0829"></td><td bgColor="#424242"></td></tr>
 <tr><td bgColor="#610B0B"></td><td bgColor="#61210B"></td><td bgColor="#61380B"></td><td bgColor="#5F4C0B"></td><td bgColor="#5E610B"></td><td bgColor="#4B610B"></td><td bgColor="#38610B"></td><td bgColor="#21610B"></td><td bgColor="#0B610B"></td><td bgColor="#0B6121"></td><td bgColor="#0B6138"></td><td bgColor="#0B614B"></td><td bgColor="#0B615E"></td><td bgColor="#0B4C5F"></td><td bgColor="#0B3861"></td><td bgColor="#0B2161"></td><td bgColor="#0B0B61"></td><td bgColor="#210B61"></td><td bgColor="#380B61"></td><td bgColor="#4C0B5F"></td><td bgColor="#610B5E"></td><td bgColor="#610B4B"></td><td bgColor="#610B38"></td><td bgColor="#610B21"></td><td bgColor="#2E2E2E"></td></tr>
 <tr><td bgColor="#3B0B0B"></td><td bgColor="#3B170B"></td><td bgColor="#3B240B"></td><td bgColor="#3A2F0B"></td><td bgColor="#393B0B"></td><td bgColor="#2E3B0B"></td><td bgColor="#243B0B"></td><td bgColor="#173B0B"></td><td bgColor="#0B3B0B"></td><td bgColor="#0B3B17"></td><td bgColor="#0B3B24"></td><td bgColor="#0B3B2E"></td><td bgColor="#0B3B39"></td><td bgColor="#0B2F3A"></td><td bgColor="#0B243B"></td><td bgColor="#0B173B"></td><td bgColor="#0B0B3B"></td><td bgColor="#170B3B"></td><td bgColor="#240B3B"></td><td bgColor="#2F0B3A"></td><td bgColor="#3B0B39"></td><td bgColor="#3B0B2E"></td><td bgColor="#3B0B24"></td><td bgColor="#3B0B17"></td><td bgColor="#1C1C1C"></td></tr>
 <tr><td bgColor="#2A0A0A"></td><td bgColor="#2A120A"></td><td bgColor="#2A1B0A"></td><td bgColor="#29220A"></td><td bgColor="#292A0A"></td><td bgColor="#222A0A"></td><td bgColor="#1B2A0A"></td><td bgColor="#122A0A"></td><td bgColor="#0A2A0A"></td><td bgColor="#0A2A12"></td><td bgColor="#0A2A1B"></td><td bgColor="#0A2A22"></td><td bgColor="#0A2A29"></td><td bgColor="#0A2229"></td><td bgColor="#0A1B2A"></td><td bgColor="#0A122A"></td><td bgColor="#0A0A2A"></td><td bgColor="#120A2A"></td><td bgColor="#1B0A2A"></td><td bgColor="#220A29"></td><td bgColor="#2A0A29"></td><td bgColor="#2A0A22"></td><td bgColor="#2A0A1B"></td><td bgColor="#2A0A12"></td><td bgColor="#151515"></td></tr>
 <tr><td bgColor="#190707"></td><td bgColor="#190B07"></td><td bgColor="#191007"></td><td bgColor="#181407"></td><td bgColor="#181907"></td><td bgColor="#141907"></td><td bgColor="#101907"></td><td bgColor="#0B1907"></td><td bgColor="#071907"></td><td bgColor="#07190B"></td><td bgColor="#071910"></td><td bgColor="#071914"></td><td bgColor="#071918"></td><td bgColor="#071418"></td><td bgColor="#071019"></td><td bgColor="#070B19"></td><td bgColor="#070719"></td><td bgColor="#0B0719"></td><td bgColor="#100719"></td><td bgColor="#140718"></td><td bgColor="#190718"></td><td bgColor="#190714"></td><td bgColor="#190710"></td><td bgColor="#19070B"></td><td bgColor="#000000"></td></tr>
</table>
    </div>
  </div>
  <div id="footer">
    <div id="button_cntr">
      <div id ="button_no" class = "buttons">no</div>
      <div id ="button_yes" class = "buttons">yes</div>
    </div>
    <div id ="ticker">그림을 그려주세요!</div>
  </div>
  <div id='spaceAlert' style='display:none'></div>
  <div id='twinkle' style='display:none'></div>
</body>
<script language="javascript" type="text/javascript">
  var sketch = function(p) {
    "use strict"

    var startingStrokes;

    var use_large_models = true;

    function Pen() {
      var state = {
        active: false,
        x: 0,
        y: 0,
        dx: 0,
        dy: 0,
        down: 0,
        up: 0,
        end: 0,
        prevDown: 0,
        prevUp: 0,
        prevEnd: 0
      }
      state.updateCurrent = function(stroke) {
        state.dx = stroke[0]
        state.dy = stroke[1]
        // we update the previous by default
        state.updateCurrentPen(stroke.slice(2, 5))
      }
      state.updatePrev = function(stroke) {
        state.dx = stroke[0]
        state.dy = stroke[1]
        // we update the previous by default
        state.updatePrevPen(stroke.slice(2, 5))
      }
      state.updateCurrentPen = function(array) {
        state.down = array[0]
        state.up = array[1]
        state.end = array[2]
      }
      state.updatePrevPen = function(array) {
        state.prevDown = array[0]
        state.prevUp = array[1]
        state.prevEnd = array[2]
      }
      state.getStroke = function() {
        return [state.dx, state.dy, state.down, state.up, state.end]
      }
      state.getCurrentPen = function() {
        return [state.down, state.up, state.end]
      }
      state.getPrevPen = function() {
        return [state.prevDown, state.prevUp, state.prevEnd]
      }
      return state;
    }

    // variables for the sketch input interface.
    var userPen = {
      currentState: 0,
      prevState: 0,
    }
    var x, y; // absolute coordinates on the screen of where the pen is
    var start_x, start_y;
    var has_started; // set to true after user starts writing.
    var just_finished_line;
    var epsilon = 1.0; // to ignore data from user's pen staying in one spot.
    var raw_line_color;
    //var raw_lines;
    var current_raw_line;
    // var strokes;
    var current_strokes;
    var final_strokes = null;
    var line_color, predict_line_color;
    var line_color_alpha = 64;
    var final_color_alpha = 255;
    var last_time; // for keeping track of drawing speed

    //UI
    var screen_width, screen_height, temperature_slider;
    var line_width = 3;
    var screen_scale_factor = 3.0;
    var task = 1;
    var ticker_showed = 0
    var tick = 0;
    var timerOn = 0;
    var tickerTimer;
    var silentTickerTimer;
    var penTouched = -1;
    var changeTicker;
    var whiteSpacePos;
    var spaceAlert = 0;
    var silentAlert = 0;
    var taskSixHasStarted = false;
    var img;
    var imgSrc;
    // var mode = "silent";
    // var mode = "talk";
    // var pictureType = 2;
    // var mode;
    // var pictureType;

    // var taskSixLineDrew = 0;
    var myInterval;
    var isIntervalStart = false;
    var intCnt = 0;
    var myInterval;
    var drawClipArt = true;
    var sy = 0;

    // dom
    var reset_button, model_sel, random_model_button;
    var text_title, text_temperature;
    var changing_model_lock = true;
    var restarting_model_lock = false;
    var restarting_model_lock_count = 0;
    var restarting_model_lock_frames = 30;
    var clear_text_color, random_text_color;
    var clear_text_background, random_text_background;
    var canvas;
    var title_text = "sketch-rnn predictor.";
    var old_title_text = "sketch-rnn";
    var run_encode_strokes;
    var ticker;
    var button_yes;
    var button_no;
    var title;
    var header;
    var footer;
    var headerHeight=55;
    var footerHeight=55;
    var select_dom;

    //settings
    var settings = new Array(3);
    //settings 0
    settings[0] = {}; //landscape
    settings[0]['presetNum'] = 4; //건물, 건물배경, 구름, 추천색
    settings[0]['presetPos'] = new Array(4);
    settings[0]['presetPos'][0] = [418, 290]; //건물
    settings[0]['presetPos'][1] = [24, 37]; //건물배경
    settings[0]['presetPos'][2] = new Array(2); //구름
    settings[0]['presetPos'][3] = [45,202] //색  //[sx,sy,dx,dy,dycol]
      // [
      //   [239,109,392,109,"blue"],
      //   [219,328,219,369,"blue"],
      //   [270,214,270,277,"blue"],
      //   [321,347,321,375,"blue"],
      //   [350,318,350,341,"blue"],
      //   [395,356,395,377,"red"],
      //   [455,360,455,379,"red"],
      //   [475,364,475,379,"red"],
      //   [507,345,513,374,"green"],
      //   [276,507,433,507,"green"]
      // ];
    settings[0]['silentAlertPosSize'] =
      [
        [464,379,150,230],
        [587,379,150,230],
        [727,382,100,100]
        // [715,90,35,60]
      ];

    settings[0]['presetSize'] = new Array(4);
    // settings[0]['presetSize'][0] = [398/4, 750/4]; //건물
    // settings[0]['presetSize'][1] = [3827/4, 2159/4]; //건물배경
    // settings[0]['presetSize'][2] = [720/4, 386/4];//새
    settings[0]['presetSize'][0] = [96, 181]; //건물
    settings[0]['presetSize'][1] = [922, 519]; //건물배경
    settings[0]['presetSize'][2] = [173, 93];//새
    settings[0]['presetSize'][3] = [885, 361];//색

    settings[0]['presetSrc'] = new Array(4);
    settings[0]['presetSrc'][0] = '../../static/imgsrc/building_1_418_290.png';
    settings[0]['presetSrc'][1] = '../../static/imgsrc/landscape_background_1_24_37.png';
    settings[0]['presetSrc'][2] = '../../static/imgsrc/birds_1.png';
    settings[0]['presetSrc'][3] = '../../static/imgsrc/landscape_color_line_45_202.png';
    settings[0]['presetImg'] = new Array(4);
    // settings[0]['alertSrc'] = 'imgsrc/MagnifyingGlassicon.png';
    // settings[0]['alertImg'] = new Array(2);
    // settings[0]['userDrewFirstIndex'] = new Array(4);
    // settings[0]['userDrewLastIndex'] = new Array(4);
    // settings[0]['userColorFirstIndex'] = new Array(4);
    // settings[0]['userColorLastIndex'] = new Array(4);
    settings[0]['taskChangerTicker'] = [1, 3, 5, 7, 10];
    settings[0]['tickerText'] = new Array(13);
    settings[0]['tickerText'][0] = '건물을 그리고 있는데 나머지 부분을 좀 그려 주실래요?';
    settings[0]['tickerText'][1] = '감사합니다. 멋진 건물이 완성되었네요 :)';
    settings[0]['tickerText'][2] = '건물 오른쪽에 비슷한 건물 하나를 그려주실래요?';
    settings[0]['tickerText'][3] = '감사합니다. 멋진 건물이 하나 더 완성되었네요 :)';
    settings[0]['tickerText'][4] = '건물과 어울릴만한 나무 하나를 그려 주실래요?';
    settings[0]['tickerText'][5] = '감사합니다. 멋진 나무네요 :)';
    settings[0]['tickerText'][6] = '건물과 나무에 어울리도록 그림을 좀 더 그려볼게요.';
    settings[0]['tickerText'][7] = '짜잔! 마음에 드시나요?';
    settings[0]['tickerText'][8] = '빈 공간이 있는 곳을 알려 주실래요?';
    settings[0]['tickerText'][9] = '감사합니다. :)';
    settings[0]['tickerText'][10] = '알려주신 빈 공간에 새를 그려 보았어요! 마음에 드시나요?';
    settings[0]['tickerText'][11] = '표시된 색으로 그림을 색칠 해 주시겠어요?';
    settings[0]['tickerText'][12] = '도와주셔서 감사합니다! 멋진 그림이 완성 되었어요 :)';
    settings[0]['timerTickerNums'] = [0, 2, 4, 8, 11];
    settings[0]['buttonHiddenNums'] = [0, 2, 4, 8, 11];
    settings[0]['silentAlertNums'] = [0, 2, 4, 8];

    //settings 1
    settings[1] = {}; //still life
    settings[1]['presetNum'] = 4; //쿠션, (강아지, 청소기), 액자, 추천색
    settings[1]['presetPos'] = new Array(4);
    settings[1]['presetPos'][0] = [371, 299]; //쿠션
    settings[1]['presetPos'][1] = [145, 207]; //(강아지, 청소기)
    settings[1]['presetPos'][2] = new Array(2); //액자
    settings[1]['presetPos'][3] = [105, 134]; //색  //[sx,sy,dx,dy,dycol]
      // [
      //   [239,109,392,109,"blue"],
      //   [219,328,219,369,"blue"],
      //   [270,214,270,277,"blue"],
      //   [321,347,321,375,"blue"],
      //   [350,318,350,341,"blue"],
      //   [395,356,395,377,"red"],
      //   [455,360,455,379,"red"],
      //   [475,364,475,379,"red"],
      //   [507,345,513,374,"green"],
      //   [276,507,433,507,"green"]
      // ];
    settings[1]['silentAlertPosSize'] =
      [
        [421,346,70,70],
        [531,342,70,70],
        [475,362,500,200]
        // [771,170,35,60]
      ];

    settings[1]['presetSize'] = new Array(4);
    settings[1]['presetSize'][0] = [102, 97]; //쿠션
    settings[1]['presetSize'][1] = [737, 331]; //(강아지, 청소기)
    settings[1]['presetSize'][2] = [349, 185];//액자
    settings[1]['presetSize'][3] = [726, 434];//선
    settings[1]['presetSrc'] = new Array(4);
    settings[1]['presetSrc'][0] = '../../static/imgsrc/cushion_371_299.png';
    settings[1]['presetSrc'][1] = '../../static/imgsrc/stilllife_background_145_207.png';
    settings[1]['presetSrc'][2] = '../../static/imgsrc/frame.png';
    settings[1]['presetSrc'][3] = '../../static/imgsrc/stilllife_color_line_105_134.png';
    settings[1]['presetImg'] = new Array(4);
    // settings[1]['alertSrc'] = 'imgsrc/MagnifyingGlassicon.png';
    // settings[1]['alertImg'] = new Array(2);
    // settings[1]['userDrewFirstIndex'] = new Array(4);
    // settings[1]['userDrewLastIndex'] = new Array(4);
    // settings[1]['userColorFirstIndex'] = new Array(4);
    // settings[1]['userColorLastIndex'] = new Array(4);
    settings[1]['taskChangerTicker'] = [1, 3, 5, 7, 10];
    settings[1]['tickerText'] = new Array(13);
    settings[1]['tickerText'][0] = '쿠션을 그리고 있는데 나머지 부분을 좀 그려 주실래요?';
    settings[1]['tickerText'][1] = '감사합니다. 멋진 쿠션이 완성되었네요 :)';
    settings[1]['tickerText'][2] = '쿠션 오른쪽에 비슷한 쿠션 하나를 그려주실래요?';
    settings[1]['tickerText'][3] = '감사합니다. 멋진 쿠션이 하나 더 완성되었네요 :)';
    settings[1]['tickerText'][4] = '쿠션과 어울릴만한 소파를 쿠션 뒤에 그려 주실래요?';
    settings[1]['tickerText'][5] = '감사합니다. 멋진 소파네요 :)';
    settings[1]['tickerText'][6] = '쿠션과 소파에 어울리도록 그림을 좀 더 그려볼게요.';
    settings[1]['tickerText'][7] = '짜잔! 마음에 드시나요?';
    settings[1]['tickerText'][8] = '빈 공간이 있는 곳을 알려 주실래요?';
    settings[1]['tickerText'][9] = '감사합니다. :)';
    settings[1]['tickerText'][10] = '알려주신 빈 공간에 액자를 그려 보았어요! 마음에 드시나요?';
    settings[1]['tickerText'][11] = '표시된 색으로 그림을 색칠 해 주시겠어요?';
    settings[1]['tickerText'][12] = '도와주셔서 감사합니다! 멋진 그림이 완성 되었어요 :)';
    settings[1]['timerTickerNums'] = [0, 2, 4, 8, 11];
    settings[1]['buttonHiddenNums'] = [0, 2, 4, 8, 11];
    settings[1]['silentAlertNums'] = [0, 2, 4, 8];
    //settings 2

    settings[2] = {}; //portrait
    settings[2]['presetNum'] = 4; //(로봇 눈, 얼굴 윤곽), 로봇 몸통, 로봇 다리, 추천색
    settings[2]['presetPos'] = new Array(4);
    settings[2]['presetPos'][0] = [0, 0]; //(로봇 눈, 얼굴 윤곽)
    settings[2]['presetPos'][1] = [291, 224]; //로봇 몸통
    // settings[2]['presetPos'][2] = new Array(2); //로봇 다리
    settings[2]['presetPos'][2] = [389, 389]; //로봇 다리
    settings[2]['presetPos'][3] = [308, 108];  //색  //[sx,sy,dx,dy,dycol]
      // [
      //   [239,109,392,109,"blue"],
      //   [219,328,219,369,"blue"],
      //   [270,214,270,277,"blue"],
      //   [321,347,321,375,"blue"],
      //   [350,318,350,341,"blue"],
      //   [395,356,395,377,"red"],
      //   [455,360,455,379,"red"],
      //   [475,364,475,379,"red"],
      //   [507,345,513,374,"green"],
      //   [276,507,433,507,"green"]
      // ];
    settings[2]['silentAlertPosSize'] =
      [
        [460,147,40,40],
        [509,147,40,40],
        [482,197,40,40]
        // [770,170,35,60]
      ];

    settings[2]['presetSize'] = new Array(4);
    settings[2]['presetSize'][0] = [980, 579]; //(로봇 눈, 얼굴 윤곽)
    settings[2]['presetSize'][1] = [393, 168]; //로봇 몸통
    settings[2]['presetSize'][2] = [200, 101];//로봇 다리
    settings[2]['presetSize'][3] = [256, 280];//선
    settings[2]['presetSrc'] = new Array(4);
    settings[2]['presetSrc'][0] = '../../static/imgsrc/portrait_black_frame_0_0.png';
    settings[2]['presetSrc'][1] = '../../static/imgsrc/robot_body_291_224.png';
    settings[2]['presetSrc'][2] = '../../static/imgsrc/legs_389_389.png';
    settings[2]['presetSrc'][3] = '../../static/imgsrc/portrait_color_line_308_108.png';
    settings[2]['presetImg'] = new Array(4);
    // settings[2]['alertSrc'] = 'imgsrc/MagnifyingGlassicon.png';
    // settings[2]['alertImg'] = new Array(2);
    // settings[2]['userDrewFirstIndex'] = new Array(4);
    // settings[2]['userDrewLastIndex'] = new Array(4);
    // settings[2]['userColorFirstIndex'] = new Array(4);
    // settings[2]['userColorLastIndex'] = new Array(4);
    settings[2]['taskChangerTicker'] = [1, 3, 5, 7, 10];
    settings[2]['tickerText'] = new Array(13);
    settings[2]['tickerText'][0] = '로봇의 눈을 그리고 있는데 나머지 부분을 좀 그려 주실래요?';
    settings[2]['tickerText'][1] = '감사합니다. 멋진 로봇 눈이 완성되었네요 :)';
    settings[2]['tickerText'][2] = '눈 오른쪽에 비슷한 눈 하나를 그려주실래요?';
    settings[2]['tickerText'][3] = '감사합니다. 멋진 로봇 눈이 하나 더 완성되었네요 :)';
    settings[2]['tickerText'][4] = '로봇 눈에 어울릴만한 입을 눈 밑에 그려 주실래요?';
    settings[2]['tickerText'][5] = '감사합니다. 멋진 입이네요 :)';
    settings[2]['tickerText'][6] = '눈과 입에 어울리도록 그림을 좀 더 그려볼게요.';
    settings[2]['tickerText'][7] = '짜잔! 마음에 드시나요?';
    settings[2]['tickerText'][8] = '빈 공간이 있는 곳을 알려 주실래요?';
    settings[2]['tickerText'][9] = '감사합니다. :)';
    settings[2]['tickerText'][10] = '알려주신 빈 공간에 다리를 그려 보았어요! 마음에 드시나요?';
    settings[2]['tickerText'][11] = '표시된 색으로 그림을 색칠 해 주시겠어요?';
    settings[2]['tickerText'][12] = '도와주셔서 감사합니다! 멋진 그림이 완성 되었어요 :)';
    settings[2]['timerTickerNums'] = [0, 2, 4, 8, 11];
    settings[2]['buttonHiddenNums'] = [0, 2, 4, 8, 11];
    settings[2]['silentAlertNums'] = [0, 2, 4, 8];
    // tracking mouse  touchpad
    var tracking = {
      down: false,
      x: 0,
      y: 0
    };

    function set_ticker_text(new_text) {
      document.getElementById("ticker").innerText = new_text;
      var btn_width;
      if(document.getElementById('button_cntr'))
      {
        btn_width = document.getElementById('button_cntr').clientWidth;
        console.log("btn_width: ",btn_width);
      }
      else btn_width = 0;
      ticker.style.width = screen_width - btn_width + 'px';
    };

    var draw_example = function(example, start_x, start_y, line_color, prev_pen_override) {
      console.log('draw_examlple called!');

      var i, j;
      var x = start_x,
        y = start_y;
      var dx, dy;
      var pen_down, pen_up, pen_end;
      var prev_pen = [1, 0, 0];

      if (Array.isArray(prev_pen_override)) {
        penState = prev_pen_override;
      }

      p.curveTightness(0.5);

      var lines = []; //save all line points
      var line = []; //save a point array of each line
      var pt;

      line.push([x, y]);

      for (i = 0; i < example.length; i++) {
        // sample the next pen's states from our probability distribution
        [dx, dy, pen_down, pen_up, pen_end] = example[i];

        if (prev_pen[2] == 1) { // end of drawing.
          break;
        }

        x += dx;
        y += dy;

        // only draw on the paper if the pen is touching the paper
        if (prev_pen[0] == 1) {
          line.push([x, y]);
        } else { //pen_up state
          lines.push(line);
          line = [];
          line.push([x, y]);
        }

        // update the previous pen's state to the current one we just sampled
        prev_pen = [pen_down, pen_up, pen_end];
      }
      if (line.length > 0) {
        lines.push(line);
        //colors, penWeight 와 lines 길이 맞추기
        while(lines.length>colors.length){
          //console.log('lines.length',lines.length,'colors.length',colors.length);
          colors.push(curCol);
          penWeights.push(curPenWeight);
          penAlphas.push(curPenAlpha);
        }
        while(lines.length<colors.length){
          //console.log('lines.length',lines.length,'colors.length',colors.length);
          colors.pop(curCol);
          penWeights.pop(curPenWeight);
          penAlphas.pop(curPenAlpha);
        }
        if(lines.length===colors.length){
          raw_lines = raw_lines.slice(0,lines.length);
          console.log('lines.length',lines.length,'colors.length',colors.length,'penWeights.length',penWeights.length,'strokes.length',strokes.length,'raw_lines.length',raw_lines.length,'penAlphas.length',penAlphas.length);
          line = [];
        }
      }

      for (i = 0; i < lines.length; i++){
        line = lines[i];
        if (line.length > 1) {
          pt = line[0];
          // p.fill(254);
          p.noFill();
          // p.stroke('black');
          var rgba = colorToRGBA(colors[i]);
          rgba[3] = penAlphas[i];
          console.log(colors[i]);
          p.stroke(rgba[0],rgba[1],rgba[2],rgba[3]);
          // p.stroke(colors[i]);
          p.strokeWeight(penWeights[i]);
          p.beginShape();
          p.curveVertex(pt[0], pt[1]);
          for (j = 0; j < line.length; j++) {
            pt = line[j];
            p.curveVertex(pt[0], pt[1]);
          }
          p.curveVertex(pt[0], pt[1]);
          p.endShape();
        }
      }
    };

    var init = function(cb) {
      header = document.getElementById("header");
      header.style.height = headerHeight;
      title = document.getElementById("title");
      footer = document.getElementById("footer");
      footer.style.height = footerHeight;
      ticker = document.getElementById("ticker");
      button_yes = document.getElementById("button_yes");
      button_no = document.getElementById("button_no");
      sketch = document.getElementById("sketch");
      if (mode === "silent"){
        // console.log(ticker.innerHTML);
        ticker.innerHTML= "";
        button_yes.style.display = "hidden";
        button_no.style.display = "hidden";
      }
      screen_width = get_window_width(); //window.innerWidth
      screen_height = (get_window_height()-(headerHeight+footerHeight)); //window.innerHeight -110 -> -220
      title.style.width = screen_width * 0.4 + 'px';
      sketch.style.height = screen_height + 'px';
      // ticker.style.width = screen_width * 0.6 + 'px';
      // pictureType = "landscape"
      // if(pictureType === "land"){
      //   pictureType = 0
      // }else if(pictureType === "still"){
      //   pictureType = 1
      // }else if(pictureType === "portrait"){
      //   pictureType = 2
      // }
      // p.colorMode(HSB,[max])
      // var canvas = document.getElementsByTagName("canvas")[0];
      canvas = document.getElementsByTagName("canvas")[0];
      canvas.addEventListener("mousedown", function(e) {
        devicePressed(e.clientX, e.clientY);
      })
      canvas.addEventListener("mousemove", function(e) {
        if (tracking.down) {
          devicePressed(e.clientX, e.clientY);
        }
      })
      canvas.addEventListener("mouseup", function(e) {
        deviceReleased();
      })
      canvas.addEventListener("touchstart", function(e) {
        e.preventDefault();
        devicePressed(e.touches[0].clientX, e.touches[0].clientY);
      })
      canvas.addEventListener("touchmove", function(e) {
        e.preventDefault();
        if (tracking.down) {
          devicePressed(e.touches[0].clientX, e.touches[0].clientY);
        }
      })
      canvas.addEventListener("touchend", function(e) {
        e.preventDefault();
        deviceReleased();
      })
      button_yes.addEventListener("click", function(e){
        if(tick>=0 && tick<settings[pictureType]['tickerText'].length){
          e.preventDefault();
          for(var i=0;i<settings[pictureType]['taskChangerTicker'].length;i++){
            if(tick == settings[pictureType]['taskChangerTicker'][i]){
              changeTicker = true;
            }
          }
          if(changeTicker){
            task += 1;
            if(task === 6) taskSixHasStarted = true;
            console.log("prev task num:", task-1,"updated task num: ", task);
            changeTicker = false;
          }
          tick += 1;
          ticker_showed = 0;
          console.log("tick: ", tick);
          // console.log("task: ", task);
          console.log("tickerText length: ", settings[pictureType]['tickerText'].length);
          if(task == 4){
            drawClipArt = true;
            sy = 0;
          }
          if(task == 6){
            drawClipArt = true;
            sy = 0;
          }
          }
      })
      cb();
    }

    function restart() {
      // reinitialize variables before calling p5.js setup.
      line_color = p.color(0, 0, 0, line_color_alpha);
      predict_line_color = p.color(p.random(64, 224), p.random(64, 224), p.random(64, 224), line_color_alpha);

      // make sure we enforce some minimum size of our demo
      screen_width = Math.max(window.innerWidth, 400);
      screen_height = (Math.max(window.innerHeight, 320)-(headerHeight+footerHeight));

      // variables for the sketch input interface.
      userPen.currentState = 0
      userPen.prevState = 1
      // pen = 0;
      // prev_pen = 1;
      has_started = false; // set to true after user starts writing.
      just_finished_line = false;
      raw_lines = [];
      current_raw_line = [];
      strokes = [];
      colors = [];
      penWeights = [];
      penAlphas = [];
      current_strokes = [];
    };

    function clear_screen() {
      // console.log("CLEAR")
      p.fill(255);
      p.noStroke();
      // p.rect(0, 0, screen_width, screen_height-41);
      p.rect(0, 0, screen_width, screen_height);
      p.stroke(0);
    };

    p.preload = function(){
      // setMode('{{ settings.1 }}','{{ settings.2 }}');
      console.log(settings);
      console.log(mode);
      console.log(pictureType);
      settings[pictureType]['presetImg'][0] = p.loadImage(settings[pictureType]['presetSrc'][0]);
      settings[pictureType]['presetImg'][1] = p.loadImage(settings[pictureType]['presetSrc'][1]);
      settings[pictureType]['presetImg'][2] = p.loadImage(settings[pictureType]['presetSrc'][2]);
      settings[pictureType]['presetImg'][3] = p.loadImage(settings[pictureType]['presetSrc'][3]);
      // settings[pictureType]['alertImg'][0] = p.loadImage(settings[pictureType]['alertSrc']);
    }

    p.setup = function() {
      // var settings_temp = document.getElementById("settings").childNodes[0].data.split(',');
      // selection2 = settings_temp[1].replace('\'','');
      // selection2 = selection2.replace(/ /gi,'');
      // selection2 = selection2.replace(/\'/gi,'');
      // selection3 = settings_temp[2].replace(/\'/gi,'');
      // selection3 = selection3.replace(']','');
      // selection3 = selection3.replace(/ /gi,'')
      console.log('{{ settings.1 }}');
      // setMode('{{ settings.1 }}','{{ settings.2 }}');
      init(function() {
        console.log('ready.');
        // draw_random_example();
      });
      restart();
      canvas = p.createCanvas(screen_width, screen_height);
      p.frameRate(30);
      // p.frameRate(10);
      clear_screen();
      last_time = +new Date()
    }

    function get_window_width() {
      // return p.windowWidth;
      return window.innerWidth;
    }

    function get_window_height() {
      // return p.windowHeight;
      return window.innerHeight;
    }
    function drawScenarioWhilePenDown(){
      var timerExist = 0;
      for(var i=0;i<13;i++){
        if(tick === settings[pictureType]['timerTickerNums'][i]){
          timerExist = 1;
        }
      }
      if(timerExist === 1 && timerOn === 1){
        clearTimeout(tickerTimer);
        timerOn = 0;
        console.log("timer cleared");
        if(mode==="silent"){
          clearTimeout(silentTickerTimer);
        }
      }
      if(task === 1 || task === 2 || task === 3){ // 1번 task
        p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
        // if(mode === "silent"){
        //   if(tick === 0){
        //     p.noFill();
        //     p.stroke(0,255,0,100);
        //     p.strokeWeight(3);
        //     p.ellipse(300,300,50,230);
        //   }
        // }
      }
      else if(task === 4 || task === 5){ // 4,5번 task
        p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
        if(tick === 7 || tick === 8 || tick === 9 || tick === 10){
          p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
        }
        if(tick === 8){
          whiteSpacePos = [tracking.x, tracking.y];
          // console.log(whiteSpacePos);
        }
        if(tick === 10 || tick === 11){
          p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], settings[pictureType]['presetPos'][2][1], settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1]);
        }
      }
      else if(task === 6){
        p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
        p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
        p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], settings[pictureType]['presetPos'][2][1], settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1]);
        p.image(settings[pictureType]['presetImg'][3], settings[pictureType]['presetPos'][3][0], settings[pictureType]['presetPos'][3][1], settings[pictureType]['presetSize'][3][0], settings[pictureType]['presetSize'][3][1]);
        // // if(tick===11){
          // for(var i=0;i<settings[pictureType]['presetPos'][3].length;i++){
          //   p.stroke(settings[pictureType]['presetPos'][3][i][4]);
          //   p.strokeWeight(3); // nice thick line
          //   p.line(settings[pictureType]['presetPos'][3][i][0], settings[pictureType]['presetPos'][3][i][1], settings[pictureType]['presetPos'][3][i][2], settings[pictureType]['presetPos'][3][i][3]);
          // }
        }
      // }
    }


    function drawScenarioWhilePenUp(){
      var timerExist = 0;
      var buttonHidden = 0;
      // var silentAlertExist = 0;
      if(tick === 6 && mode === "silent" && task  === 4){
        tick = 7;
        setTimeout(function(){
          task = 5;
          tick = 8;
          timerOn = 0;
          ticker_showed = 0;
          // silentAlert = 0;
          console.log("silentTickerTimer");
          console.log("tick: ", tick);
          console.log("prev task num:", task-1,"updated task num: ", task);
        }, 4000);//tick 7 -> 8, task 4 -> 5;
        // task = 5;
      }
      // if(tick === 9 && mode === "silent"){
      //   tick = 10;
      // }
      if(tick === 10 && mode === "silent"){
        tick = 11;
        setTimeout(function(){
          task += 1;
          timerOn = 0;
          ticker_showed = 0;
          // silentAlert = 0;
          console.log("silentTickerTimer");
          console.log("tick: ", tick);
          console.log("prev task num:", task-1,"updated task num: ", task);
        }, 4000);
      }
      for(var i=0;i<settings[pictureType]['timerTickerNums'].length;i++){
        if(tick === settings[pictureType]['timerTickerNums'][i]){
          timerExist = 1;
        }
      }
      for(var i=0;i<settings[pictureType]['buttonHiddenNums'].length;i++){
        if(tick === settings[pictureType]['buttonHiddenNums'][i]){
          buttonHidden = 1;
        }
      }
      for(var i=0;i<settings[pictureType]['silentAlertNums'].length;i++){
        if(tick === settings[pictureType]['silentAlertNums'][i] && mode === "silent" && silentAlert === 0){
          // silentAlertExist = 1;
          if(tick!=8){
            p.noFill();
            p.stroke(235,23,0,100);
            p.strokeWeight(3);
            p.ellipse(settings[pictureType]['silentAlertPosSize'][i][0],settings[pictureType]['silentAlertPosSize'][i][1],settings[pictureType]['silentAlertPosSize'][i][2],settings[pictureType]['silentAlertPosSize'][i][3]);
          }
          else if(tick===8){
            // p.image(settings[pictureType]['alertImg'][0], settings[pictureType]['silentAlertPosSize'][i][0], settings[pictureType]['silentAlertPosSize'][i][1], settings[pictureType]['silentAlertPosSize'][i][2], settings[pictureType]['silentAlertPosSize'][i][3]);
              myInterval = setInterval(function(){
                  console.log('interval');
                  isIntervalStart = true;
                  if(intCnt > 4){
                    clearInterval(myInterval);
                    // isTimeCntStart = false;
                    isIntervalStart = false;
                    intCnt = 0;
                  }
                  var twinkle = document.getElementById('twinkle');
                  if(twinkle.style.display == 'none') twinkle.style.display = 'initial';
                  else twinkle.style.display = 'none'
                  intCnt++;
                }, 500);  //0.5sec 주기로 반짝
            }
          silentAlert = 1;
        }
      }

      if(timerExist === 1 && timerOn === 0 && penTouched === 1){
        timerStart();
        if(tick == 8 && mode== "silent"){
          setTimeout(function(){
            tick += 1;
            timerOn = 0;
            ticker_showed = 0;
            console.log("tickerTimer");
            console.log("tick: ", tick);
            console.log("prev task num:", task-1,"updated task num: ", task);
          }, 6000);
        }
        timerOn = 1;
        penTouched = 0;
        if(mode==="silent" && tick != 8 && tick!=11 && tick!=12 && tick!=13){
          silentTimerStart();
        }
      }
      if(buttonHidden === 1){
        button_yes.style.display = "none";
        button_no.style.display = "none";
      }
      else{
        button_yes.style.display = "initial";
        // button_yes.style.display = "block";
        button_no.style.display = "none";
        button_yes.innerText = "Ok";
      }
      if(mode==="silent"){
        button_yes.style.display = "none";
        button_no.style.display = "none";
        ticker.style.display = "none";
      }
      // console.log(button_yes.style.display)
      // console.log(button_no.style.display)
      // if(silentAlertExist){
      //   p.ellipse(settings[pictureType]['silentAlertPos'][tick][0],settings[pictureType]['silentAlertPos'][tick][1],settings[pictureType]['silentAlertPos'][tick][2],settings[pictureType]['silentAlertPos'][tick][3]);
      //   silentAlert = 1;
      // }
      // if(mode === "silent" && silentAlert === 0){
      //   p.noFill();
      //   p.stroke(235,23,0,100);
      //   p.strokeWeight(3);
      //   if(tick === 0){
      //     p.ellipse(settings[0]['silentAlertPos'][0][0],settings[0]['silentAlertPos'][0][1],settings[0]['silentAlertPos'][0][2],settings[0]['silentAlertPos'][0][3]);
      //     console.log(settings[0]['silentAlertPos'][0]);
      //     silentAlert = 1;
      //   }
      // }
      if(tick>=0 && tick<settings[pictureType]['tickerText'].length && ticker_showed === 0 && mode === "talk"&& timerOn != 1){
        set_ticker_text(settings[pictureType]['tickerText'][tick]);
        ticker_showed = 1;
      }
      //sweep
      // sweep++;
      // if(drawClipArt){
      //   clear_screen();
      //   if(task === 1 || task === 2 || task === 3){ // 1, 2, 3번 task
      //     p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], (settings[pictureType]['presetPos'][0][1]-settings[pictureType]['presetSize'][0][1])+sy, settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1],0,sy-settings[pictureType]['presetSize'][0][1]);
      //     sy += settings[pictureType]['presetSize'][0][1]/30;
      //     console.log(drawClipArt,task,sy);
      //     if(sy>settings[pictureType]['presetSize'][0][1]){
      //       // drawClipArtAfterSweep = true;
      //       drawClipArt = false;
      //     }
      //   }
      //   else if(task === 4 || task === 5){ // 4번 task
      //     p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
      //     // if(tick === 7 || tick === 8 || tick === 9 || tick === 10){
      //     if(tick === 7 || tick === 8 || tick === 9){
      //       p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], (settings[pictureType]['presetPos'][1][1]-settings[pictureType]['presetSize'][1][1])+sy, settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1],0,sy-settings[pictureType]['presetSize'][1][1]);
      //       sy += settings[pictureType]['presetSize'][1][1]/30;
      //       console.log(drawClipArt,task,sy);
      //       if(sy>settings[pictureType]['presetSize'][1][1]){
      //         drawClipArt = false;
      //       }
      //       // p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
      //     }
      //     else if(tick === 10 || tick === 11){
      //       p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
      //       p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], (settings[pictureType]['presetPos'][2][1]-settings[pictureType]['presetSize'][2][1])+sy, settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1],0,sy-settings[pictureType]['presetSize'][2][1]);
      //       sy += settings[pictureType]['presetSize'][2][1]/30;
      //       if(sy>settings[pictureType]['presetSize'][2][1]){
      //         // drawClipArtAfterSweep = true;
      //         drawClipArt = false;
      //       }
      //       // p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], settings[pictureType]['presetPos'][2][1], settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1]);
      //       // console.log("tick image loaded",tick)
      //     }
      //   }
      //   else if(task === 6){
      //     p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
      //     p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
      //     p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], settings[pictureType]['presetPos'][2][1], settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1]);
      //     // p.image(settings[pictureType]['presetImg'][3], settings[pictureType]['presetPos'][3][0], (settings[pictureType]['presetPos'][3][1]-settings[pictureType]['presetSize'][3][1])+sy, settings[pictureType]['presetSize'][3][0], settings[pictureType]['presetSize'][3][1],0,sy-settings[pictureType]['presetSize'][3][1]);
      //     // sy += settings[pictureType]['presetSize'][3][1]/30;
      //     // if(sy>settings[pictureType]['presetSize'][3][1]){
      //     //   // drawClipArtAfterSweep = true;
      //     //   drawClipArt = false;
      //     // }
      //     p.image(settings[pictureType]['presetImg'][3], settings[pictureType]['presetPos'][3][0], settings[pictureType]['presetPos'][3][1], settings[pictureType]['presetSize'][3][0], settings[pictureType]['presetSize'][3][1]);
      //   }
      // }
      // else{
        if(task === 1 || task === 2 || task === 3){ // 1, 2, 3번 task
          p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
        }
        else if(task === 4 || task === 5){ // 4번 task
          p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
          // if(tick === 7 || tick === 8 || tick === 9 || tick === 10){
          if(tick === 7 || tick === 8 || tick === 9){
            p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
          }
          else if(tick === 10 || tick === 11){
            p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
            p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], settings[pictureType]['presetPos'][2][1], settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1]);
            // console.log("tick image loaded",tick)
          }
        }
        else if(task === 6){
          p.image(settings[pictureType]['presetImg'][0], settings[pictureType]['presetPos'][0][0], settings[pictureType]['presetPos'][0][1], settings[pictureType]['presetSize'][0][0], settings[pictureType]['presetSize'][0][1]);
          p.image(settings[pictureType]['presetImg'][1], settings[pictureType]['presetPos'][1][0], settings[pictureType]['presetPos'][1][1], settings[pictureType]['presetSize'][1][0], settings[pictureType]['presetSize'][1][1]);
          p.image(settings[pictureType]['presetImg'][2], settings[pictureType]['presetPos'][2][0], settings[pictureType]['presetPos'][2][1], settings[pictureType]['presetSize'][2][0], settings[pictureType]['presetSize'][2][1]);
          p.image(settings[pictureType]['presetImg'][3], settings[pictureType]['presetPos'][3][0], settings[pictureType]['presetPos'][3][1], settings[pictureType]['presetSize'][3][0], settings[pictureType]['presetSize'][3][1]);
          // if(tick===11 ){
            // if(taskSixLineDrew === 0){
          // for(var i=0;i<settings[pictureType]['presetPos'][3].length;i++){
          //   p.stroke(settings[pictureType]['presetPos'][3][i][4]);
          //   p.strokeWeight(3); // nice thick line
          //   p.line(settings[pictureType]['presetPos'][3][i][0], settings[pictureType]['presetPos'][3][i][1], settings[pictureType]['presetPos'][3][i][2], settings[pictureType]['presetPos'][3][i][3]);
          //   // taskSixLineDrew = 1;
          // }
        }
      // }
      if(task === 5){
        if(tick === 8){
          whiteSpacePos = [tracking.x, tracking.y]; // why +55?
          // console.log("trackings: "+tracking.x, tracking.y);
          // console.log("whiteSpacePos: "+whiteSpacePos);
        }
        else if(tick === 9){
          if(spaceAlert === 0){
            makeSpaceAlert(whiteSpacePos[0], whiteSpacePos[1]+55, 100);
            if(pictureType != 2){
              settings[pictureType]['presetPos'][2][0] = (whiteSpacePos[0] - ((settings[pictureType]['presetSize'][2][0])/2));
              settings[pictureType]['presetPos'][2][1] = (whiteSpacePos[1] - ((settings[pictureType]['presetSize'][2][1])/2));
              }
            spaceAlert = 1;
            console.log("whiteSpacePos: "+whiteSpacePos);
            console.log("spaceAlert: "+spaceAlert);
          }
        }
      }
    }


    p.draw = function() {
      // if(tick>=0 && tick<settings[pictureType]['tickerText'].length && ticker_showed === 0 && mode === "talkative"&& timerOn != 1){
      //   set_ticker_text(settings[pictureType]['tickerText'][tick]);
      //   ticker_showed = 1;
      // }
      screen_width = get_window_width();
      screen_height = (get_window_height()-(headerHeight+footerHeight));

      // record pen drawing from user:
      clear_text_color = "rgba(0,0,0,0.5)"; // #3393d1
      random_text_color = "rgba(0,0,0,0.5)"; // #3393d1
      clear_text_background = false;
      random_text_background = false;
      if (tracking.down && (tracking.x > 0) && (tracking.x < screen_width) && (tracking.y > 0) && tracking.y < screen_height) { // pen is touching the paper
      // if (model_loaded && tracking.down && (tracking.x > 0) && (tracking.x < screen_width) && (tracking.y > 0) && tracking.y < screen_height) { // pen is touching the paper
      penTouched = 1;
        if (userPen.prevState == 1) {
          if (task!=6) clear_screen();
          // clear_screen();
          //내가 마우스 누르는동안 이전 오브젝트 그리기
          if(strokes.length) draw_example(strokes, start_x, start_y, line_color);
          drawScenarioWhilePenDown();
          // if(strokes.length) draw_example(strokes, start_x, start_y, line_color);
        }
        if (has_started == false) { // first time anything is written
          restarting_model_lock = false;
          restart();
          strokes = [];
          // if (task!=6) clear_screen();
          // if (task!=6) clear_screen();
          has_started = true;
          // demo_finished = true;

          line_color_alpha = final_color_alpha;
          line_color = p.color(0, 0, 0, line_color_alpha);
          // predict_line_color = p.color(p.random(64, 224), p.random(64, 224), p.random(64, 224), line_color_alpha);
          // predict_line_color = curCol;

          x = tracking.x;
          y = tracking.y;
          start_x = x;
          start_y = y;
          userPen.currentState = 0;
          current_raw_line.push([x, y]);
        } else {
          // drawScenarioWhilePenDown();
          //사용자가 그림 그리는 부분 설정
          var dx0 = tracking.x - x; // candidate for dx
          var dy0 = tracking.y - y; // candidate for dy
          if (dx0 * dx0 + dy0 * dy0 > epsilon * epsilon) { // only if pen is not in same area
            var dx = dx0;
            var dy = dy0;
            userPen.currentState = 0

            if (userPen.prevState == 0) {
              var rgba = colorToRGBA(curCol);
              rgba[3] = curPenAlpha;
              // console.log(rgba[0],rgba[1],rgba[2],rgba[3]);
              // var c = p.color(255,0,0,100);
              // p.stroke(c);//c, alpha값 주는 건 안 됨(alpha값이 추가로 안 들어감)
              // p.stroke(255,0,0,50);
              p.stroke(rgba[0],rgba[1],rgba[2],rgba[3]);
              p.strokeWeight(curPenWeight); // nice thick line
              p.line(x, y, x + dx, y + dy); // draw line connecting prev point to current point.
              // console.log(curCol);
              // console.log(curPenWeight);
            }

            // update the absolute coordinates from the offsets
            x += dx;
            y += dy;

            // update raw_lines
            current_raw_line.push([x, y]);
            just_finished_line = true;

            // using the previous pen states, and hidden state, get next hidden state
            // update_rnn_state();
          }
          // clear_screen();
          // drawScenarioWhilePenDown();
          // if(strokes.length) draw_example(strokes, start_x, start_y, line_color);
        }
      }
      else { // pen is above the paper
        // if (taskSixHasStarted === true) { // first time anything is written
        //   // restarting_model_lock = false;
        //   var canva = document.getElementsByTagName("canvas")[0];
        //   console.log(canva)
        //   img = convertCanvasToImage(canva);
        //   imgSrc = convertCanvasToImageSrc(canva);
        //   var canvas = document.getElementsByTagName("canvas")[0];
        //   canvas = convertImageToCanvas(img);
        //   init(function() {
        //     console.log('ready.');
        //     // draw_random_example();
        //   });
        //   restart();
        //   console.log('restarted');
        //   // if(task!=6) clear_screen();
        //   taskSixHasStarted = false;
        //   console.log('taskSixHasStarted'+taskSixHasStarted);
        // }
        // console.log("pen up");
        userPen.currentState = 1;
        if(task == 6) clear_screen();
        // drawScenarioWhilePenUp()
        if(strokes.length) draw_example(strokes, start_x, start_y, line_color);
        drawScenarioWhilePenUp()
        if (just_finished_line) {
          //라인좌표를 curveVertex곡선으로 변환
          var current_raw_line_simple = DataTool.simplify_line(current_raw_line);
          var idx, last_point, last_x, last_y;

          if (current_raw_line_simple.length > 1) {
            if (raw_lines.length === 0) {
              last_x = start_x;
              last_y = start_y;
            }
            else {
              idx = raw_lines.length - 1;
              last_point = raw_lines[idx][raw_lines[idx].length - 1];
              last_x = last_point[0];
              last_y = last_point[1];
            }
            //raw_lines -> strokes 절대좌표를 상대좌표로 변환
            var stroke = DataTool.line_to_stroke(current_raw_line_simple, [last_x, last_y]);
            raw_lines.push(current_raw_line_simple);
            strokes = strokes.concat(stroke);
            current_strokes = current_strokes.concat(stroke);

            // redraw simplified strokes
            // if(task!=6) clear_screen();
            clear_screen();
            // drawScenarioWhilePenUp()
            if(strokes.length) draw_example(strokes, start_x, start_y, line_color);
            drawScenarioWhilePenUp()
            old_title_text = title_text;
          } else {
            if (raw_lines.length === 0) {
              has_started = false;
            }
          }

          current_raw_line = [];
          just_finished_line = false;
        }
      }
      userPen.prevState = userPen.currentState;
    };
    var timerStart = function() {
      console.log("timer start");
      // ticker_showed = 0;
      tickerTimer = setTimeout(function(){
        tick += 1;
        timerOn = 0;
        ticker_showed = 0;
        console.log("tickerTimer");
        console.log("tick: ", tick);
        console.log("prev task num:", task-1,"updated task num: ", task);
        // if(task == 4){
        //   drawClipArt = true;
        //   sy = 0;
        // }
        // if(task == 6){
        //   drawClipArt = true;
        //   sy = 0;
        // }
      }, 5000); //5초 후 이동
    }
    var silentTimerStart = function() {
      console.log("silent timer start");
      // ticker_showed = 0;
      silentTickerTimer = setTimeout(function(){
        tick += 1;
        task += 1;
        timerOn = 0;
        ticker_showed = 0;
        silentAlert = 0;
        console.log("silentTickerTimer");
        console.log("tick: ", tick);
        console.log("prev task num:", task-1,"updated task num: ", task);
        if(task == 4){
          drawClipArt = true;
          sy = 0;
        }
        // if(task == 6){
        //   drawClipArt = true;
        //   sy = 0;
        // }
      }, 6000); //6초 후 이동
    }

    var deviceReleased = function() {
      tracking.down = false;
      // console.log(tracking.down)
    }

    var devicePressed = function(x, y) {
      tracking.x = x;
      tracking.y = (y-headerHeight); //header만큼 빼줌
      if (!tracking.down) {
        tracking.down = true;
      }
      // console.log(tracking.down, tracking.x, tracking.y)
    };

//-----------------------sungwoo added below here-------------------
    //strokes를 역으로 raw_lines에 추가
    function StrokeToRaw(){
      //raw_lines의 총 개수 계산
      var raw_lines_cnt = 0;
      for(var j=0; j<raw_lines.length; j++){
        raw_lines_cnt += raw_lines[j].length;
      }
      console.log('raw_lines_cnt', raw_lines_cnt);

      var idx = raw_lines_cnt - 1;

      while(true){
        var arr = [];
        var last_point = raw_lines[raw_lines.length-1][raw_lines[raw_lines.length-1].length-1];
        //pen_up까지의 하나의 오브젝트를 arr에 담음
        while(true){
          idx++;
          if(arr.length) arr.push([arr[arr.length-1][0]+strokes[idx][0], arr[arr.length-1][1]+strokes[idx][1]]);
          else arr.push([last_point[0]+strokes[idx][0], last_point[1]+strokes[idx][1]]);

          if(strokes[idx][3]==1) break;
        }
        raw_lines.push(arr);
        if(idx==strokes.length-1) break;
      }

    }

    function checkArea(){
      //계산 너무 많으면 mul*mul 픽셀당 계산
      var occupied = 0;
      var mul = 60; //한 격자당 가로세로 픽셀 개수 셋팅
      p.noStroke();
      for(var i=0; i<screen_width; i+=mul){
        for(var j=0; j<screen_height; j+=mul){
          console.log('i= ',i,' j= ',j);
          var k = p.get(i+mul/2, j+mul/2);
          if(k[0]!=255 || k[1]!=255 || k[2]!=255){
            occupied++;
            p.fill(255,0,0,100); //alpha 0~255 (255 is exactly solid color)
            p.rect(i,j,mul,mul);
          }
          else{
            p.fill(0,0,0,100);
            p.rect(i,j,mul,mul);
          }
        }
      }
      var pct = occupied*mul*mul/(screen_width*screen_height)*100;
      pct = Math.floor(pct, 1);
      console.log('all', screen_width*screen_height, 'px, occupied', occupied*mul*mul, 'px, percent', pct,'%');
    }

    function checkAreaByArray(){
      p.loadPixels();
      //console.log(pixels); // debug
      var d = p.pixelDensity(); // maybe 1~2, 레티나 디스플레이 보정
      var idx=0;
      var mul = 1;
      var occupied = 0;

      for(var i=0; i<screen_height; i++){
        for(var j=0; j<screen_width; j++){
          idx = j*4*d + i*screen_width*4*d*d;
          var r = p.pixels[idx];
          var g = p.pixels[idx+1];
          var b = p.pixels[idx+2];
          //console.log(idx);
          if(r!=255 || g!=255 || b!=255){
            occupied++;
          }
        }
      }
      var pct = occupied/(screen_width*screen_height)*100;
      pct = Math.round(pct);
      console.log('pixel density is ',d);
      console.log('all', screen_width*screen_height, 'px, occupied', occupied, 'px, percent', pct,'%');
    }

    function checkWhiteSpace(){
      //안보이는 외곽선 만들기
      p.stroke(254,254,254,255);
      p.line(0,0,0,screen_height);
      p.line(0,0,screen_width,0);
      p.line(0,screen_height,screen_width,screen_height);
      p.line(screen_width,0,screen_width,screen_height);
      //특정 좌표에서 그림과 간섭없는 가장 큰 원 그리기
      var x=0, y=0; //중심좌표
      var x2, y2_p, y2_n //검색할 좌표
      var r=1 //거리, 원의 반지름
      var del_r = 10; //몇픽셀 단위로 측정할지
      var del_x = 1; //몇픽셀 단위로 x좌표 이동할지, 증가시 캔버스 외곽선 통가할 가능성있음
      var del_xy = 50; //몇픽셀 단위로 측정점 설정할지
      var isStopped = false;
      var isTouched = false;
      //x^2 + y^2 = r^2 -> y = +- sqrt(r^2-x^2)
      p.loadPixels();
      var pxl = p.pixels;
      //console.log(pixels); // debug
      var d = p.pixelDensity(); // maybe 1~2, 레티나 디스플레이 보정
      var search_limit;
      var res=[]; //결과저장 list

      search_limit = Math.sqrt(screen_width*screen_width + screen_height*screen_height);
      for(var i=1; i<screen_height/del_xy; i++){
      for(var j=1; j<screen_width/del_xy; j++){
        isStopped = false;
        x = j*del_xy;
        y = i*del_xy;

//        p.noStroke();
//        p.fill(254,0,0,100); //alpha 0~255 (255 is exactly solid color)
//        p.rect(x,y,5,5);

        //최대거리용 원 셋업
        p.noFill();
        p.stroke(0,0,255,100);
        p.strokeWeight(1);

        for(r=0; r<search_limit; r+=del_r){ //계산부하 줄이려면 del_r 높임
          if(isStopped) break;
          isTouched = false;

          for(x2=x+r; x2>=x-r; x2-=del_x){ //계산부하 줄이려면 x2증분 높임
            if(isTouched) break;
            y2_p = y + Math.round(Math.sqrt(r*r-(x2-x)*(x2-x)));
            y2_n = y - Math.round(Math.sqrt(r*r-(x2-x)*(x2-x)));
            //캔버스 바깥범위는 탐색 안하도록. 최적화
            //p5 메소드 콜시에 시간오래 걸림. 중복반복문에선 안쓰는게 좋음

            if(x2<0 || x2>screen_width) continue;
            else if(y2_p>screen_height) checkCoordinate(x2, y2_n);
            else if(y2_n<0) checkCoordinate(x2, y2_p);
            else{
              checkCoordinate(x2, y2_p);
              checkCoordinate(x2, y2_n);
            }
          }
        }
      }
      }

      res.sort(function(a,b){return a.r<b.r ? 1 : a.r>b.r ? -1 : 0;});
      for(var i=0; i<1; i++){
//        p.noFill();
//        p.stroke(0,0,255,100);
//        p.ellipse(res[i].x, res[i].y, res[i].r*2, res[i].r*2);
//        p.noStroke();
//        p.fill(255,0,0,100); //alpha 0~255 (255 is exactly solid color)
//        p.rect(res[i].x,res[i].y,5,5);
//        console.log(res[i].i,res[i].j, res[i].r);
        makeSpaceAlert(res[i].x,res[i].y,res[i].r);
      }

      //y2_n, y2_p 구분해서 입력하면 최소 접촉좌표 x2, y2 및 거리 r 계산하는 내부함수
      function checkCoordinate(x2, y2){
        //체크점 표시
//        p.rect(x2,y2,1,1);
        //y2 search
        var idx = x2*4*d + y2*screen_width*4*d*d; //좌표 -> 배열인덱스 매핑
        var red = pxl[idx];
        var g = pxl[idx+1];
        var b = pxl[idx+2];
        var a = pxl[idx+3];
        if((red!=255 || g!=255 || b!=255)&&a==255){
//        if(a=255){
//          p.ellipse(x,y,r*2,r*2);
//          console.log('stop searching at i=',i, 'j=',j,'\n rgb=', red, g, b, '\n r=', r,'x=', x2, 'y=', y2);
          res.push({
            i:i,
            j:j,
            r:r,
            x:x,
            y:y,
            x2:x2,
            y2:y2
          });
          isStopped = true;
          isTouched = true;
        }
      }
    }

    p.keyPressed = function(){
      if(p.keyCode===32){ //space
        checkWhiteSpace();
            checkAreaByArray();
  //          checkArea();
      }
      else if(p.keyCode===p.ENTER){
        console.log('ENTER PRESSED...save canvas to jpg file');
        // p.saveCanvas(p.canvas,"canvasImage","png"); //save image
        page_transition(p);
      }
    }

    p.mousePressed = function(){
      new_start_x = p.mouseX;
      new_start_y = p.mouseY;
      var px = p.get(new_start_x, new_start_y);
      console.log(new_start_x, new_start_y, px);
    }

    //아이콘클릭 효과
    document.getElementById('penWeight').addEventListener('click', function(e){
      //e.target.style.backgroundColor = 'gray';
      curPenWeight = 3;
      curPenAlpha = 255;
      console.log('curPenWeight', curPenWeight);
    });
    document.getElementById('brushWeight').addEventListener('click', function(e){
      //e.target.style.backgroundColor = 'gray';
      curPenWeight = 15;
      curPenAlpha = 150;
      console.log('curPenWeight', curPenWeight);
    });
    document.getElementById('cancel').addEventListener('click', cancelClick);

    function cancelClick(){
      colors.pop();
      penWeights.pop();
      //raw_lines에는 절대좌표 기록, strokes에는 상대 좌표 거리 기록
      //sketchRNN은 strokes만 만들고 raw_line은 안만듦
      if(raw_lines.length) raw_lines.pop();
      while(true){
        if(strokes) strokes.pop();
        if(strokes.length==0 || strokes[strokes.length-1][3]==1) break;
      }
      // if(task!=6) clear_screen();
      clear_screen();
      if(colors.length==0){ //오브젝트 하나도 없으면 재시작
        has_started = false;
        return;
      }
      draw_example(strokes, start_x , start_y, line_color);
    }

    function convertCanvasToImage(canvas) {
    	var image = new Image();
    	image.src = canvas.toDataURL("image/png");
    	return image;
    }

    function convertCanvasToImageSrc(canvas) {
    	var src = new Image();
    	src = canvas.toDataURL("image/png");
    	return src;
    }

    // Converts image to canvas; returns new canvas element
    function convertImageToCanvas(image) {
    	var canvas = document.createElement("canvas");
    	canvas.width = image.width;
    	canvas.height = image.height;
    	canvas.getContext("2d").drawImage(image, 0, 0);
  	  return canvas;
    }
  }
    var custom_p5 = new p5(sketch, 'sketch');

  var new_start_x, new_start_y;
  var curPenWeight = 3;
  var curPenAlpha = 255;
  var colors = []; //save all colors of each line
  var penWeights = [];
  var penAlphas = [];
  var isModelDrawn = false;
  var strokes;
  var raw_lines;
  var extStrokesLength;
  var mode;
  var pictureType;

  //---------------------팔레트 아이콘
  var pallet = document.getElementById('pallet'); //팔레트 아이콘 돔
  var palVal = document.getElementById('palVal'); //팔레트 확장영역 돔
  var p_wdt = 70, p_hgt = 70; //팔레트 아이콘 크기
  //pallet css 설정
  pallet.style.width = p_wdt+'px';
  pallet.style.height = p_hgt+'px';
  //palVal css 설정
  palVal.style.display ='none';
  palVal.style.boxSizing = 'border-box';
  palVal.style.width = '150px';
  palVal.style.height = '200px';
  palVal.style.borderRadius = '20px';
  palVal.style.border = '5px solid gray';
  palVal.style.backgroundColor = 'rgba(100,100,100,.5)'
  palVal.style.position = 'absolute';
  palVal.style.left = p_wdt/2+'px';
  palVal.style.top = p_hgt/2+'px';
  palVal.style.padding = '20px 10px';
  palVal.style.zIndex = 0;

  // var colorArr = ['black', 'green', 'blue', 'pink', 'yellow', 'purple', 'cyan', 'orange', 'red'];
  var curCol = 'black'; //현재 선택된컬러
  // colorArr.forEach(function(item, i){
  //   var colVal = document.createElement('div');
  //   palVal.appendChild(colVal);
  //   colVal.setAttribute('class', 'colorVal'); // 공통 css적용
  //   colVal.style.backgroundColor = item;
  //   //컬러 선택시 변하는 부분 이벤트
  //   colVal.addEventListener('click', function(e){
  //     curCol = e.target.style.backgroundColor;
  //     console.log(curCol);
  //     pallet.style.backgroundColor = curCol;
  //   });
  // });
  //
  // var p_cntr = document.getElementById('p_cntr');
  // p_cntr.addEventListener('mouseover', function(){
  //   palVal.style.display ='initial';
  // });
  // p_cntr.addEventListener('mouseout', function(){
  //   palVal.style.display ='none';
  // });
  pallet.addEventListener('click', function(){
    if(palVal.style.display == 'none'){
      palVal.style.display ='initial';
    }
    else palVal.style.display ='none';
  });

  //빈공간 알려주는 돔 생성
  function makeSpaceAlert(x,y,r){
    var mapVal = .6; //r의 몇배크기 원 만들지
    var wdt = r*mapVal*2;
    var hgt = r*mapVal*2;
    var circle = document.getElementById('spaceAlert');
    circle.style.left = x+'px';
    circle.style.top = y+'px';
    circle.style.display = 'initial';
    circle.style.width = '0px';
    circle.style.height = '0px';
    circle.style.border = '5px dotted red';
    setTimeout(function(){
      circle.style.border = '5px dotted transparent';
      circle.style.width = wdt+'px';
      circle.style.height = hgt+'px';
      circle.style.left = x-wdt/2+'px';
      circle.style.top = y-hgt/2+'px';
    }, 10);
    setTimeout(function(){
      circle.style.display = 'none';
    }, 2000);
  }
  // function convertCanvasToImage(canvas) {
  //   var image = new Image();
  //   image.src = canvas.toDataURL("image/png");
  //   return image;
  // }
  // // Converts image to canvas; returns new canvas element
  // function convertImageToCanvas(image) {
  //   var canvas = document.createElement("canvas");
  //   canvas.width = image.width;
  //   canvas.height = image.height;
  //   canvas.getContext("2d").drawImage(image, 0, 0);
  //   return canvas;
  // }
  function bodyOnLoad(){
    console.log("body onload start")
    setMode('{{ settings.1 }}','{{ settings.2 }}');
    var iconEle = document.getElementsByClassName('icons');
    for(var i=0; i<iconEle.length-1; i++){
      iconEle[i].style.backgroundColor = 'rgb(200,200,200)';
    }
    document.getElementById('twinkle').addEventListener('click', function(e){
      e.preventDefault();
      return;
    });
    var tdArr = document.querySelectorAll('td');
    tdArr.forEach(function(item){
      item.addEventListener('click', function(e){
        curCol = e.target.getAttribute('bgcolor');
        console.log(curCol);
        pallet.style.backgroundColor = curCol;
        if(palVal.style.display == 'none'){
          palVal.style.display ='initial';
        }
        else palVal.style.display ='none';
      });
    });
  }
  // document.body.onload = function(){
  //   console.log("body onload start")
  //   setMode('{{ settings.1 }}','{{ settings.2 }}');
  //   var iconEle = document.getElementsByClassName('icons');
  //   for(var i=0; i<iconEle.length-1; i++){
  //     iconEle[i].style.backgroundColor = 'rgb(200,200,200)';
  //   }
  //   document.getElementById('twinkle').addEventListener('click', function(e){
  //     e.preventDefault();
  //     return;
  //   });
  //   var tdArr = document.querySelectorAll('td');
  //   tdArr.forEach(function(item){
  //     item.addEventListener('click', function(e){
  //       curCol = e.target.getAttribute('bgcolor');
  //       console.log(curCol);
  //       pallet.style.backgroundColor = curCol;
  //       if(palVal.style.display == 'none'){
  //         palVal.style.display ='initial';
  //       }
  //       else palVal.style.display ='none';
  //     });
  //   });
  // }

  function setMode(a,b){ // a=landsacpe, stilllife, portrait b=talkative, silent
    pictureType = a;
    mode = b;
    if(mode == "talk") document.getElementById('button_sel3').innerText = '#Talktive';
    else document.getElementById('button_sel3').innerText = '#Silent';

    if(pictureType == "land") {
      pictureType = 0;
      document.getElementById('button_sel2').innerText = '#Landscape';
    }
    else if(pictureType == "still"){
      pictureType = 1;
      document.getElementById('button_sel2').innerText = '#Still life';
    }
    else if(pictureType == "portrait"){
      pictureType = 2;
      document.getElementById('button_sel2').innerText = '#Portrait';
    }
    console.log(pictureType)
    console.log(mode)
  }

  function colorToRGBA(color) {
    // Returns the color as an array of [r, g, b, a] -- all range from 0 - 255
    // color must be a valid canvas fillStyle. This will cover most anything
    // you'd want to use.
    // Examples:
    // colorToRGBA('red')  # [255, 0, 0, 255]
    // colorToRGBA('#f00') # [255, 0, 0, 255]
    var cvs, ctx;
    cvs = document.createElement('canvas');
    cvs.height = 1;
    cvs.width = 1;
    ctx = cvs.getContext('2d');
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, 1, 1);
    return ctx.getImageData(0, 0, 1, 1).data;
}

function page_transition(p) {
  img_b64 = p.canvas.toDataURL();
  var data = new FormData();
  data.append('img_src', img_b64);
  data.append('id', uniqueid());

  $.ajax({
    type : "POST",
    url : "{% url 'colorize' %}",
    data: data,
    cache: false,
    contentType: false,
    processData: false,
    error : function(request, status, error) {
      alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
    },
    success : function() {
      window.location.href = "{% url 'colorize' %}"
    }
  });

}
</script>
</html>
